<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/blog/libs/katex/katex.min.css"> <link rel=stylesheet  href="/blog/libs/highlight/github.min.css"> <!-- <script src="https://unpkg.com/lunr/lunr.js"></script> <script src="/blog/libs/lunr/lunr.min.js"></script> <script src="/blog/libs/lunr/lunr_index.js"></script> <script src="/blog/libs/lunr/lunrclient.min.js"></script> --> <link rel=stylesheet  type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css"> <link rel=stylesheet  href="/blog/css/franklin.css"> <link rel=stylesheet  href="/blog/css/basic.css"> <link rel=stylesheet  href="/blog/css/custom.css"> <link rel=stylesheet  href="/blog/css/katex_custom.css"> <link rel=stylesheet  href="/blog/css/admonitions.css"> <link rel=icon  href="/blog/assets/favicon.ico"> <title>Geodesic solutions from a symbolic metric with Julia</title> <header> <div class=blog-name ><a href="/blog/"><code style="font-size:20px;">/var/log/fjebaker.log</code></a></div> <div class=blog-header > <div> <div id=menu-nav > <nav> <ul> <li><a href="/blog/">Home</a> </ul> </nav> </div> <!-- <div style="margin-right: 0.5em;"> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/blog/search/index.html"> </form> </div> --> </div> </div> </header> <div class=franklin-content ><h1 id=geodesic_solutions_from_a_symbolic_metric_with_julia ><a href="#geodesic_solutions_from_a_symbolic_metric_with_julia" class=header-anchor >Geodesic solutions from a symbolic metric with Julia</a></h1> <p>The Julia programming language has a very rich and complete differential equation solving library, courtesy of <a href="http://sciml.ai">SciML</a>, implementing a very diverse <a href="https://diffeq.sciml.ai/stable/solvers/ode_solve/">number of solvers</a>, ideal for many different mathematical applications.</p> <p>The geodesic equation is an equation in the field of differential geometry that requires integrating, and describes the shortest path between two points on arbitrarily curved spaces. For some point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">x</span></span></span></span> on a manifold <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant=script >M</mi></mrow><annotation encoding="application/x-tex">\mathcal{M}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathcal">M</span></span></span></span>, the geodesic equation is</p> <a id=eq-geodesic  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><msup><mtext>d</mtext><mn>2</mn></msup><msup><mi>x</mi><mi>i</mi></msup></mrow><mrow><mtext>d</mtext><msup><mi>λ</mi><mn>2</mn></msup></mrow></mfrac><mo>=</mo><mo>−</mo><msubsup><mi mathvariant=normal >Γ</mi><mrow><mphantom><mi>i</mi></mphantom><mi>j</mi><mi>k</mi></mrow><mi>i</mi></msubsup><mfrac><mrow><mtext>d</mtext><msup><mi>x</mi><mi>j</mi></msup></mrow><mrow><mtext>d</mtext><mi>λ</mi></mrow></mfrac><mfrac><mrow><mtext>d</mtext><msup><mi>x</mi><mi>k</mi></msup></mrow><mrow><mtext>d</mtext><mi>λ</mi></mrow></mfrac><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \frac{\text{d} ^2 x^i}{\text{d} \lambda^2} = - \Gamma^{ i}_{\phantom{ i} jk} \frac{\text{d} x^j}{\text{d} \lambda} \frac{\text{d} x^k}{\text{d} \lambda}, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.261448em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.575448em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class=mord ><span class="mord mathnormal">λ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8984479999999999em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.212108em;vertical-align:-0.686em;"></span><span class=mord >−</span><span class=mord ><span class=mord >Γ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.874664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:transparent;">i</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">jk</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5016639999999999em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class="mord mathnormal">λ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.526108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class="mord mathnormal">λ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >d</span></span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi mathvariant=normal >Γ</mi><mrow><mphantom><mi>i</mi></mphantom><mi>j</mi><mi>k</mi></mrow><mi>i</mi></msubsup></mrow><annotation encoding="application/x-tex"> \Gamma^{ i}_{\phantom{ i} jk}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.2438799999999999em;vertical-align:-0.4192159999999999em;"></span><span class=mord ><span class=mord >Γ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.824664em;"><span style="top:-2.4168920000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:transparent;">i</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">jk</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.4192159999999999em;"><span></span></span></span></span></span></span></span></span></span> are the Christoffel symbols, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span></span></span></span> is an affine parameter.</p> <p>Calculating the components of this equation is, in general, an academic labour of love, which can be delegated to <em>computer algebra systems</em> &#40;CAS&#41;, such as SageMath.</p> <p>Julia has a maturing computer algebra system of its own, in the form of <a href="https://github.com/JuliaSymbolics/Symbolics.jl">Symbolics.jl</a>, originally developed for uses in simplifying dynamical system modelling in SciML. By building on the abstract type hierarchy of Julia, Symbolics.jl is more feature rich than the documentation might initially suggest – allowing use of e.g. the linear algebra package with symbolic expression. The developers have instead focused on converting symbolic expressions into useable, parallelizable Julia functions. For an example of how powerful this can be, see <a href="https://symbolics.juliasymbolics.org/dev/tutorials/auto_parallel/">call stack tracing for auto-parallelization</a>.</p> <p>With the intention of integrating eq. <span class=eqref >(<a href="#eq-geodesic">1</a>)</span> for an arbitrary manifold given only the symbolic metric, we hope to explore whether Julia&#39;s emergent features are capable enough to already support symbolic tensor algebra, by integrating and visualizing null-geodesics in the Eddington-Finkelstein coordinates.</p> <h2 id=symbolic_tensors_and_contractions ><a href="#symbolic_tensors_and_contractions" class=header-anchor >Symbolic tensors and contractions</a></h2> <p>As good of a place to start as any is with writing tensor equations in Julia; the difficulty here is the way in which index contractions are expressed. Fortunately, Julia has numerous Einsum implementations, such as <a href="https://github.com/mcabbott/Tullio.jl">Tullio.jl</a>, which allows for very expressive code.</p> <p>For example, consider the vector dot product</p> <a id=eq-u-dot-u  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>u</mi><mo>⋅</mo><mi>u</mi><mo>=</mo><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>i</mi><mi>j</mi></mrow><mrow></mrow></msubsup><msup><mi>u</mi><mi>i</mi></msup><msup><mi>u</mi><mi>j</mi></msup><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> u \cdot u = g^{ }_{\phantom{ } ij} u^i u^j, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1.2577720000000001em;vertical-align:-0.383108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.41300000000000003em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8746639999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">u</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span><span class=mpunct >,</span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>i</mi><mi>j</mi></mrow><mrow></mrow></msubsup></mrow><annotation encoding="application/x-tex"> g^{ }_{\phantom{ } ij}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.825332em;vertical-align:-0.394772em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.363em;"><span style="top:-2.441336em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span> is the metric.</p> <p>We can express a symbolic vector and metric &#40;matrix&#41;, and Tullio provides the contraction abstraction for us:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Symbolics, Tullio

<span class=hljs-meta >@variables</span> u[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>] g[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>, <span class=hljs-number >1</span>:<span class=hljs-number >4</span>]
<span class=hljs-meta >@tullio</span> out := g[i, j] * u[i] * u[j]</code></pre> <p>Combining this with something like <a href="https://github.com/korsbo/Latexify.jl">Latexify.jl</a> for the output already provides most of the necessary tools to begin tensor symbolics.</p> <p>For raising and lowering indices, both the metric and the inverse metric are required. For sufficiently small dimensions, we may use Julia matrices to represent the metric:</p> <pre><code class="julia hljs"><span class=hljs-meta >@variables</span> M, t, r, θ, ϕ

g = zeros(Num, (<span class=hljs-number >4</span>, <span class=hljs-number >4</span>))

<span class=hljs-comment ># Eddington-Finkelstein metric</span>
g[<span class=hljs-number >1</span>, <span class=hljs-number >1</span>] = -(<span class=hljs-number >1</span> - <span class=hljs-number >2</span> * M / r)
g[<span class=hljs-number >2</span>, <span class=hljs-number >2</span>] = <span class=hljs-number >1</span> + <span class=hljs-number >2</span> * M / r
g[<span class=hljs-number >3</span>, <span class=hljs-number >3</span>] = r^<span class=hljs-number >2</span>
g[<span class=hljs-number >4</span>, <span class=hljs-number >4</span>] = (r * sin(θ))^<span class=hljs-number >2</span>

<span class=hljs-comment ># off-diagonal</span>
g[<span class=hljs-number >1</span>, <span class=hljs-number >2</span>] = <span class=hljs-number >2</span> * M / r
g[<span class=hljs-number >2</span>, <span class=hljs-number >1</span>] = g[<span class=hljs-number >1</span>, <span class=hljs-number >2</span>]</code></pre> <p>and calculate the inverse using the linear algebra package <code>inv</code>:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> LinearAlgebra

ginv = inv(g)</code></pre> <h3 id=christoffel_symbols ><a href="#christoffel_symbols" class=header-anchor >Christoffel symbols</a></h3> <p>With Tullio, expressing tensor equations is very natural. The symmetrized Christoffel symbols are</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msubsup><mi mathvariant=normal >Γ</mi><mrow><mphantom><mi>i</mi></mphantom><mi>j</mi><mi>k</mi></mrow><mi>i</mi></msubsup><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><msubsup><mi>g</mi><mphantom><mi>i</mi><mi>m</mi></mphantom><mrow><mi>i</mi><mi>m</mi></mrow></msubsup><mrow><mo fence=true >(</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>m</mi><mi>j</mi></mrow><mrow></mrow></msubsup></mrow><mrow><mi mathvariant=normal >∂</mi><msup><mi>x</mi><mi>k</mi></msup></mrow></mfrac><mo>+</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>m</mi><mi>k</mi></mrow><mrow></mrow></msubsup></mrow><mrow><mi mathvariant=normal >∂</mi><msup><mi>x</mi><mi>j</mi></msup></mrow></mfrac><mo>−</mo><mfrac><mrow><mi mathvariant=normal >∂</mi><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>j</mi><mi>k</mi></mrow><mrow></mrow></msubsup></mrow><mrow><mi mathvariant=normal >∂</mi><msup><mi>x</mi><mi>m</mi></msup></mrow></mfrac><mo fence=true >)</mo></mrow><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \Gamma^{ i}_{\phantom{ i} jk} = \frac{1}{2} g^{ im}_{\phantom{ im} } \left( \frac{\partial g^{ }_{\phantom{ } mj}}{\partial x^k} + \frac{\partial g^{ }_{\phantom{ } mk}}{\partial x^j} - \frac{\partial g^{ }_{\phantom{ } jk}}{\partial x^m} \right), </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.2577720000000001em;vertical-align:-0.383108em;"></span><span class=mord ><span class=mord >Γ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.874664em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:transparent;">i</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">jk</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.453686em;vertical-align:-0.95003em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8746639999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="color:transparent;">im</span></span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">im</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.479212em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.7751079999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.7847720000000002em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.363em;"><span style="top:-2.441336em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">mj</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.394772em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.750664em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.363em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">mk</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2831079999999999em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5036559999999999em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal">x</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.590392em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.809216em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord  style="margin-right:0.05556em;">∂</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.363em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">jk</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.4192159999999999em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>or, using Tullio</p> <pre><code class="julia hljs">δ = map(Differential, [t, r, θ, ϕ])

<span class=hljs-meta >@tullio</span> Γ[i, j, k] := <span class=hljs-number >1</span> / <span class=hljs-number >2</span> * ginv[i, m] * (
        expand_derivatives(
            δ[k](g[m, j]) + δ[j](g[m, k]) - δ[m](g[j, k])
        )
    )</code></pre> <p>Apart from the call to <code>expand_derivatives</code> &#40;which could also be broadcast later&#41;, the code we write in Julia is intuitive and almost identical to the mathematical form. </p> <h3 id=geodesic_equation ><a href="#geodesic_equation" class=header-anchor >Geodesic equation</a></h3> <p>Expressing eq. <span class=eqref >(<a href="#eq-geodesic">1</a>)</span> with Tullio is also extremely simple:</p> <pre><code class="julia hljs"><span class=hljs-meta >@variables</span> v[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>] <span class=hljs-comment ># velocity vector</span>
<span class=hljs-meta >@tullio</span> δ²xδλ²[i] := -Γ[i, j, k] * v[j] * v[k]</code></pre> <p>We&#39;ve now assembled the full geodesic equation symbolically, in pure Julia, in just a handful of lines of code&#33;</p> <p>To wrap this all into a function:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> geodesic_eqs(g, v, δ)
    ginv = inv(g)
    <span class=hljs-meta >@tullio</span> Γ[i, j, k] :=
        <span class=hljs-number >1</span> / <span class=hljs-number >2</span> * ginv[i, m] * (
            expand_derivatives(
                δ[k](g[m, j]) + δ[j](g[m, k]) - δ[m](g[j, k])
            )
        )
    <span class=hljs-meta >@tullio</span> δ²xδλ²[i] := -Γ[i, j, k] * v[j] * v[k]
    simplify.(δ²xδλ²)
<span class=hljs-keyword >end</span></code></pre> <p>where we broadcast <code>simplify</code> in the last line of the function in an attempt &#40;and hope&#41; to reduce complexity.</p> <h3 id=limitations ><a href="#limitations" class=header-anchor >Limitations</a></h3> <p>Symbolics.jl is still a maturing library, and cannot simplify or expand equations as effectively as veteran toolkits like SageMath. Likewise, the <code>solve_for</code> function in Symbolics.jl is currently limited to only linear equations, which quickly becomes problematic in non-linear coordinates. </p> <p>In the above case of the Eddington-Finkelstein metric, the expressions produced with Julia are considerably more complex that those produced with SageMath. These differences are even more drastic when examining more involved metrics, such as Kerr-Newman in Boyer-Lindquist coordinates. If obtaining simplified equations is the desire, it is unsurprising SageMath is the better tool, but it is impressive how much Julia is already able to accomplish in this domain. Furthermore, as one might expect, Julia remains orders of magnitude faster&#33;</p> <h2 id=integrating_the_geodesic_equation ><a href="#integrating_the_geodesic_equation" class=header-anchor >Integrating the geodesic equation</a></h2> <p>Using Symbolics.jl&#39;s <code>build_function</code>, we can use <code>geodesic_eqs</code> to construct a Julia function that we can wrap and pass an integration problem to DifferentialEquations.jl. An implementation of this may look like:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> build_ode(g, coords, v, args)
    δ = map(Differential, coords)
    geod = geodesic_eqs(g, v, δ)
    build_function(geod, [coords...], v, args...)
<span class=hljs-keyword >end</span></code></pre> <p>which is used</p> <pre><code class="julia hljs">func = build_ode(g, [t, r, θ, ϕ], v, [M])</code></pre>
<p>Note that <code>build_function</code>, and therefore <code>build_ode</code>, return two functional variants – one with in-place and one with an out-of-place signature. Anticipating the performance improvement of <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a>, we will use the out-of-place variant:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> DifferentialEquations, StaticArrays

geo_func = eval(func[<span class=hljs-number >1</span>]) <span class=hljs-comment ># use out-of-place</span>

<span class=hljs-keyword >function</span> intprob(u, p, λ)
    x = <span class=hljs-meta >@view</span>(u[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>])
    v = <span class=hljs-meta >@view</span>(u[<span class=hljs-number >5</span>:<span class=hljs-number >8</span>])
    du = geo_func(x, v, <span class=hljs-number >1.0</span>) <span class=hljs-comment ># fixed mass example</span>
    SVector(v..., du...)
<span class=hljs-keyword >end</span>

u0 = SVector(
    <span class=hljs-number >0.0</span>, <span class=hljs-number >200.0</span>, <span class=hljs-literal >π</span> / <span class=hljs-number >2.0</span>, <span class=hljs-number >0.0</span>, <span class=hljs-comment ># initial position 4-vector</span>
    normalize([<span class=hljs-number >0.0</span>, -<span class=hljs-number >1.0</span>, <span class=hljs-number >0.0</span>, <span class=hljs-number >1.5e-4</span>])... <span class=hljs-comment ># initial velocity 4-vector</span>
)

prob = ODEProblem{<span class=hljs-literal >false</span>}(intprob, u0, (<span class=hljs-number >0.0</span>, <span class=hljs-number >500.0</span>), <span class=hljs-literal >nothing</span>)
sol = solve(prob, Tsit5())</code></pre>
<p>We can visualize the solution with basic polar plotting:</p>
<pre><code class="julia hljs"><span class=hljs-keyword >using</span> Plots

pl = plot(
    _ -&gt; <span class=hljs-number >1.0</span>, <span class=hljs-comment ># event horizon radius</span>
    <span class=hljs-number >0</span>:<span class=hljs-number >0.01</span>:<span class=hljs-number >2</span><span class=hljs-literal >π</span>,
    lw = <span class=hljs-number >2</span>,
    legend = <span class=hljs-literal >false</span>,
    proj = :polar,
    color = :black,
    range=(<span class=hljs-number >0.0</span>, <span class=hljs-number >10.0</span>) <span class=hljs-comment ># limit the view close to the origin</span>
)

<span class=hljs-comment ># plot solution</span>
plot!(sol, vars=(<span class=hljs-number >4</span>, <span class=hljs-number >2</span>))</code></pre>
<p><img src="./geodesic-example.svg" alt=geodesic-example  /></p>
<p>We must now attempt to restrict the type of geodesic we are calculating.</p>
<p>Recall that three domains exist depending on the value of eq. <span class=eqref >(<a href="#eq-u-dot-u">2</a>)</span>, with null geodesics having <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>⋅</mo><mi>u</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">u \cdot u = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.44445em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⋅</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span>. The initial velocity vector must be constrained by the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> component to satisfy this condition in order for the solution to be light-like &#40;i.e. a photon path&#41;. A simple way of achieving this is to calculate</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msubsup><mi>g</mi><mrow><mphantom></mphantom><mi>i</mi><mi>j</mi></mrow><mrow></mrow></msubsup><msup><mi>v</mi><mi>i</mi></msup><msup><mi>v</mi><mi>j</mi></msup><mo>=</mo><mn>0</mn><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">

 g^{ }_{\phantom{ } ij} v^i v^j = 0,

</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.2577720000000001em;vertical-align:-0.383108em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.41300000000000003em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8746639999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.874664em;"><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span></span>
<p>for an initial velocity vector <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span>, using the numerical value of the metric at the initial position <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">u</span></span></span></span>, to find an initial value of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> which keeps the geodesic light-like.</p>
<p>The expression to solve is straight forward to generate. In the case where we only change the initial velocity angles <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi></mrow><annotation encoding="application/x-tex">\phi</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal">ϕ</span></span></span></span>, we can simplify the problem a little</p>
<pre><code class="julia hljs"><span class=hljs-comment ># dummy velocity components</span>
<span class=hljs-meta >@variables</span> vt0, vθ, vϕ

vel_vec = [vt0, -<span class=hljs-number >1.0</span>, vθ, vϕ]
<span class=hljs-meta >@tullio</span> out := g[i, j] * vel_vec[i] * vel_vec[j]</code></pre>
<p>solving</p>
<pre><code class="julia hljs">out ~ <span class=hljs-number >0</span></code></pre>
<p>The equation we assemble and store in <code>out</code> is</p>
<a id=eq-vt-out  class=anchor ></a><span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mn>1</mn><mo>+</mo><mfrac><mrow><mn>2</mn><mi>M</mi></mrow><mi>r</mi></mfrac><mo>+</mo><msubsup><mi>v</mi><mi>θ</mi><mn>2</mn></msubsup><msup><mi>r</mi><mn>2</mn></msup><mo>+</mo><msubsup><mi>v</mi><mi>t</mi><mn>2</mn></msubsup><mrow><mo fence=true >(</mo><mfrac><mrow><mn>2</mn><mi>M</mi></mrow><mi>r</mi></mfrac><mo>−</mo><mn>1</mn><mo fence=true >)</mo></mrow><mo>−</mo><mfrac><mrow><mn>4</mn><mi>M</mi><msub><mi>v</mi><mi>t</mi></msub></mrow><mi>r</mi></mfrac><mo>+</mo><msup><mrow><mi>sin</mi><mo>⁡</mo></mrow><mn>2</mn></msup><mrow><mo fence=true >(</mo><mi>θ</mi><mo fence=true >)</mo></mrow><msubsup><mi>v</mi><mi>ϕ</mi><mn>2</mn></msubsup><msup><mi>r</mi><mn>2</mn></msup><mo>=</mo><mn>0</mn><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">

1 + \frac{2 M}{r} + v_\theta^{2} r^{2} + v_t^{2} \left(\frac{2 M}{r} - 1 \right) - \frac{ 4 M v_t}{r} + \sin^{2}\left( \theta \right) v_\phi^{2} r^{2} = 0,
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >1</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.1111079999999998em;vertical-align:-0.247em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.40003em;vertical-align:-0.95003em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >1</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:2.04633em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.36033em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >4</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1.254976em;vertical-align:-0.383108em;"></span><span class=mop ><span class=mop >sin</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.871868em;"><span style="top:-3.12076em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">ϕ</span></span></span><span style="top:-3.1130000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.383108em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span></span>
<p>which we would want to solve for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p>
<p>We now encounter the current limitations of Symbolics.jl, namely the lack on non-linear symbolic solvers leaving us no simple way to rearrange the symbolic expression for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. Here, however, <a href="https://github.com/JuliaNLSolvers/NLsolve.jl">NLsolve.jl</a> will be able to approximate a numerical solution. This involves building a function from our symbolic expression, and exposing only <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as an argument for which to find the roots of eq. <span class=eqref >(<a href="#eq-vt-out">5</a>)</span>. </p>
<p>We build the function with</p>
<pre><code class="julia hljs">con_func_sym = build_function(
    out,
    vt0, vθ, vϕ,    <span class=hljs-comment ># velocity components</span>
    [t, r, θ, ϕ],   <span class=hljs-comment ># initial position for calculating metric</span>
    M               <span class=hljs-comment ># additional argument</span>
)

con_func = eval(con_func_sym)</code></pre>
<p>In order to use this with NLsolve, we wrap the function as the optimization target</p>
<pre><code class="julia hljs"><span class=hljs-keyword >function</span> optimf!(F, x)
    F[<span class=hljs-number >1</span>] = con_func(x[<span class=hljs-number >1</span>], u0[<span class=hljs-number >7</span>], u0[<span class=hljs-number >8</span>], <span class=hljs-meta >@view</span>(u[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>]), <span class=hljs-number >1.0</span>)
<span class=hljs-keyword >end</span></code></pre>
<p>and could choose to compute the Jacobian symbolically for a better &#40;and faster&#41; result. For brevity, I will leave this out, and simply use</p>
<pre><code class="julia hljs">nsol = nlsolve(optimf!, [<span class=hljs-number >1.0</span>])</code></pre>
<p>Note that eq. <span class=eqref >(<a href="#eq-vt-out">5</a>)</span> has two solutions for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, representing the forward and backward direction of time. In our case, we are examining a stationary metric, and thus the solutions are equivalent – but we can push the solver to find one solution over another by tweaking the initial value, as above, to start in the positive domain.</p>
<p>With <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> constrained, we reassemble <code>u0</code> and integrate again:</p>
<pre><code class="julia hljs">u0 = SVector(
    u0[<span class=hljs-number >1</span>:<span class=hljs-number >4</span>]...,
    normalize([nsol.zero[<span class=hljs-number >1</span>], u0[<span class=hljs-number >6</span>:<span class=hljs-number >8</span>]...])...
)

prob = ODEProblem{<span class=hljs-literal >false</span>}(intprob, u0, (<span class=hljs-number >0.0</span>, <span class=hljs-number >500.0</span>), <span class=hljs-literal >nothing</span>)

sol = solve(prob, Tsit5())</code></pre>
<p>Plotting the solution of the null geodesic in this metric:</p>
<p><img src="./geodesic-example-2.svg" alt=geodesic-example-2  /></p>
<p>Although this numerically driven approach works, the equations Symbolics.jl simplifies are still complex, and will posit a performance overhead that can become problematic. Furthermore, the use of numerical algorithms where analytic solutions are known, as in the case of constraining the velocity for a null geodesic, will scale poorly for many geodesics. Calls to SymPy may be made to aid in the symbolic processes to alleviate this, but then the novelty of the pure Julia implementation is lost; instead, I believe patience and the steady development of Symbolics.jl will eventually permit such a feat.</p>
<p>Until then, we may explore a SageMath-Julia hybrid method which leverages the best of both languages, to generate fast and simpler symbolic expressions.</p>
<h2 id=a_sagemath-julia_workflow ><a href="#a_sagemath-julia_workflow" class=header-anchor >A SageMath-Julia workflow</a></h2>
<p>The recipe is a well known and simple one:</p>
<ol>
<li><p>Compute the geodesic equation symbolically in SageMath, with use of SageManifold, in a simplified form.</p>

<li><p>Determine a symbolic solution to the null-geodesic constraint problem, expressing <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">v_t</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as a function of the other parameters.</p>

<li><p>Export these equations as string expressions, to then copy as Julia code.</p>

</ol>
<p>The SageMath script involved is simple:</p>
<pre><code class="python hljs"><span class=hljs-keyword >import</span> itertools
<span class=hljs-comment ># helper function for iterating indices</span>
<span class=hljs-keyword >def</span> <span class="hljs-title function_">indexprod</span>(<span class=hljs-params >n</span>):
    <span class=hljs-keyword >return</span> itertools.product(*[KM.irange() <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-built_in >range</span>(n)])

<span class=hljs-comment ># define a manifold</span>
KM = Manifold(<span class=hljs-number >4</span>, <span class=hljs-string >&#x27;M&#x27;</span>, latex_name=<span class=hljs-string >r&#x27;\mathcal{M}&#x27;</span>, start_index=<span class=hljs-number >0</span>)  
chart.&lt;t,r,theta,phi&gt; = KM.chart()

<span class=hljs-comment ># mass symbol</span>
M = var(<span class=hljs-string >&#x27;M&#x27;</span>)
<span class=hljs-comment ># velocity component symbols</span>
vt, vr, vtheta, vphi = var(<span class=hljs-string >&quot;v_t, v_r, v_theta, v_phi&quot;</span>)

<span class=hljs-comment ># metric</span>
g = KM.lorentzian_metric(<span class=hljs-string >&#x27;g&#x27;</span>)
g[<span class=hljs-number >0</span>,<span class=hljs-number >0</span>] = -(<span class=hljs-number >1</span> - <span class=hljs-number >2</span>*m/r)
g[<span class=hljs-number >0</span>,<span class=hljs-number >1</span>] = <span class=hljs-number >2</span>*m/r
g[<span class=hljs-number >1</span>,<span class=hljs-number >1</span>] = <span class=hljs-number >1</span> + <span class=hljs-number >2</span>*m/r
g[<span class=hljs-number >2</span>,<span class=hljs-number >2</span>] = r^<span class=hljs-number >2</span>
g[<span class=hljs-number >3</span>,<span class=hljs-number >3</span>] = (r*sin(theta))^<span class=hljs-number >2</span>

<span class=hljs-comment ># compute Christoffel</span>
cs = g.christoffel_symbols()

<span class=hljs-comment ># assemble geodesic equation components</span>
geodesic_equation = [<span class=hljs-number >0</span>, <span class=hljs-number >0</span>, <span class=hljs-number >0</span>, <span class=hljs-number >0</span>]
vel = [vt, vr, vtheta, vphi]
<span class=hljs-keyword >for</span> (i, j, k) <span class=hljs-keyword >in</span> indexprod(<span class=hljs-number >3</span>):
    geodesic_equation[i] += - cs[i, j, k] * vel[j] * vel[k]

<span class=hljs-comment ># assemble constraint equation</span>
constraint_equation = <span class=hljs-number >0</span>
ginv = g.inverse()
<span class=hljs-keyword >for</span> (i, j) <span class=hljs-keyword >in</span> indexprod(<span class=hljs-number >2</span>):
    constraint_equation += g[i,j] * vel[i] * vel[j]</code></pre>
<p>The constraint equation we generate here is</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mfrac><mrow><msup><mi>r</mi><mn>3</mn></msup><msubsup><mi>v</mi><mi>ϕ</mi><mn>2</mn></msubsup><mi>sin</mi><mo>⁡</mo><msup><mrow><mo fence=true >(</mo><mi>θ</mi><mo fence=true >)</mo></mrow><mn>2</mn></msup><mo>+</mo><msup><mi>r</mi><mn>3</mn></msup><msubsup><mi>v</mi><mi>θ</mi><mn>2</mn></msubsup><mo>+</mo><mrow><mo fence=true >(</mo><mn>2</mn><mtext> </mtext><mi>m</mi><mo>+</mo><mi>r</mi><mo fence=true >)</mo></mrow><msubsup><mi>v</mi><mi>r</mi><mn>2</mn></msubsup><mo>+</mo><mn>4</mn><mtext> </mtext><mi>m</mi><msub><mi>v</mi><mi>r</mi></msub><msub><mi>v</mi><mi>t</mi></msub><mo>+</mo><mrow><mo fence=true >(</mo><mn>2</mn><mtext> </mtext><mi>m</mi><mo>−</mo><mi>r</mi><mo fence=true >)</mo></mrow><msubsup><mi>v</mi><mi>t</mi><mn>2</mn></msubsup></mrow><mi>r</mi></mfrac><mo>=</mo><mn>0</mn><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">
\frac{r^{3} v_{\phi}^{2} \sin\left({\theta}\right)^{2} + r^{3} v_{\theta}^{2} + {\left(2 \, m + r\right)} v_{r}^{2} + 4 \, m v_{r} v_{t} + {\left(2 \, m - r\right)} v_{t}^{2}}{r} = 0,
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.449224em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.7632240000000001em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.809216em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.4192159999999999em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >sin</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4168920000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.2831079999999999em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >4</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span></span>
<p>c.f. eq. <span class=eqref >(<a href="#eq-vt-out">5</a>)</span> with <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>r</mi></msub><mo>=</mo><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">v_r = -1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >−</span><span class=mord >1</span></span></span></span>, which we can ask SageMath to solve symbolically:</p>
<pre><code class="python hljs">vt_sols = (constraint_equation.expr() == <span class=hljs-number >0</span>).solve(vt)</code></pre>
<p>to obtain:</p>
<span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><msub><mi>v</mi><mi>t</mi></msub><mo>=</mo><mfrac><mrow><mo>−</mo><mn>2</mn><mtext> </mtext><mi>m</mi><msub><mi>v</mi><mi>r</mi></msub><mo>±</mo><msqrt><mrow><mo>−</mo><mrow><mo fence=true >(</mo><mn>2</mn><mtext> </mtext><mi>m</mi><mi>r</mi><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup><mo fence=true >)</mo></mrow><msubsup><mi>v</mi><mi>ϕ</mi><mn>2</mn></msubsup><mi>sin</mi><mo>⁡</mo><msup><mrow><mo fence=true >(</mo><mi>θ</mi><mo fence=true >)</mo></mrow><mn>2</mn></msup><mo>−</mo><mrow><mo fence=true >(</mo><mn>2</mn><mtext> </mtext><mi>m</mi><mi>r</mi><mo>−</mo><msup><mi>r</mi><mn>2</mn></msup><mo fence=true >)</mo></mrow><msubsup><mi>v</mi><mi>θ</mi><mn>2</mn></msubsup><mo>+</mo><msubsup><mi>v</mi><mi>r</mi><mn>2</mn></msubsup></mrow></msqrt><mi>r</mi></mrow><mrow><mn>2</mn><mtext> </mtext><mi>m</mi><mo>−</mo><mi>r</mi></mrow></mfrac><mo separator=true >,</mo><mspace linebreak=newline ></mspace></mrow><annotation encoding="application/x-tex">
v_{t} 
    = \frac{-2 \, m v_{r} \pm \sqrt{-{\left(2 \, m r - r^{2}\right)} v_{\phi}^{2} \sin\left({\theta}\right)^{2} - {\left(2 \, m r - r^{2}\right)} v_{\theta}^{2} + v_{r}^{2}} r}{2 \, m - r}, \\
</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.58056em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.99933em;vertical-align:-0.7693300000000001em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.23em;"><span style="top:-2.557296em;"><span class=pstrut  style="height:3.243296em;"></span><span class=mord ><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span><span style="top:-3.473296em;"><span class=pstrut  style="height:3.243296em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-4.23em;"><span class=pstrut  style="height:3.243296em;"></span><span class=mord ><span class=mord >−</span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >±</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.243296em;"><span class=svg-align  style="top:-3.8em;"><span class=pstrut  style="height:3.8em;"></span><span class=mord  style="padding-left:1em;"><span class=mord >−</span><span class=mord ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.795908em;"><span style="top:-2.3986920000000005em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">ϕ</span></span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.4374159999999999em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >sin</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.954008em;"><span style="top:-3.2029em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=minner ><span class="mopen delimcenter" style="top:0em;">(</span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.7959079999999998em;"><span style="top:-2.398692em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span style="top:-3.0448em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.30130799999999996em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.740108em;"><span style="top:-2.4530000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.247em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.203296em;"><span class=pstrut  style="height:3.8em;"></span><span class=hide-tail  style="min-width:1.02em;height:1.8800000000000001em;"><svg width='400em' height='1.8800000000000001em' viewBox='0 0 400000 1944' preserveAspectRatio='xMinYMin slice'><path d='M983 90
l0 -0
c4,-6.7,10,-10,18,-10 H400000v40
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M1001 80h400000v40h-400000z'/></svg></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.596704em;"><span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span></span><span class="mspace newline"></span></span></span></span>
<p>which is much more convenient to work with.</p>
<p>It is now trivial to export this equation, along with the geodesic components, as plain string expressions and paste them as Julia code in the REPL. For more complex metrics, the generated expressions are repulsively long, and require some caching to be performant, which Julia is not able to automatically do &#40;e.g., evaluate <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mo stretchy=false >(</mo><mi>θ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">\sin(\theta)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mop >sin</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class=mclose >)</span></span></span></span> once per call, and reuse the same value throughout the function body&#41;. Luckily, with modern text editors, a string-search-replace is a rapid way to mimic this.</p>
<h2 id=remarks ><a href="#remarks" class=header-anchor >Remarks</a></h2>
<p>The pure Julia symbolic approach for geodesic equations will be implemented in <a href="https://github.com/astro-group-bristol/DiffGeoSymbolics.jl">DiffGeoSymbolics.jl</a>, and a SageMath abstraction is already implemented in <a href="https://github.com/astro-group-bristol/ComputedGeodesicEquations.jl">ComputedGeodesicEquations.jl</a>. This is all part of a black hole simulating ecosystem I am developing as part of my PhD, hosted on the Astrophysics Group Bristol GitHub organization.</p>
<div class=page-foot >
  <div class=copyright >
    &copy; Fergus Baker. Last modified: March 17, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>