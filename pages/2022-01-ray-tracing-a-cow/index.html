<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/blog/libs/katex/katex.min.css"> <link rel=stylesheet  href="/blog/libs/highlight/github.min.css"> <script src="https://unpkg.com/lunr/lunr.js"></script> <script src="/blog/libs/lunr/lunr.min.js"></script> <script src="/blog/libs/lunr/lunr_index.js"></script> <script src="/blog/libs/lunr/lunrclient.min.js"></script> <link rel=stylesheet  type="text/css" href="https://cdn.jsdelivr.net/gh/aaaakshat/cm-web-fonts@latest/fonts.css"> <link rel=stylesheet  href="/blog/css/franklin.css"> <link rel=stylesheet  href="/blog/css/basic.css"> <link rel=stylesheet  href="/blog/css/custom.css"> <link rel=stylesheet  href="/blog/css/katex_custom.css"> <link rel=icon  href="/blog/assets/favicon.png"> <title>Ray-tracing meshes in curved geometries</title> <header> <div class=blog-name ><a href="/blog/"><code style="font-size:20px;">/var/log/fjebaker.log</code></a></div> <nav> <ul> <li><a href="/blog/">Home</a> <li style="margin-right: 15px;"><a href="/blog/menu3/">Tags</a> <li> <form id=lunrSearchForm  name=lunrSearchForm > <input class=search-input  name=q  placeholder="Enter search term" type=text > <input type=submit  value=Search  formaction="/blog/search/index.html"> </form> </ul> <img src="/blog/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class=franklin-content ><h1 id=ray-tracing_meshes_in_curved_geometries ><a href="#ray-tracing_meshes_in_curved_geometries" class=header-anchor >Ray-tracing meshes in curved geometries</a></h1> <p>I&#39;ve recently refactored <a href="https://github.com/astro-group-bristol/GeodesicTracer.jl">some software</a> I&#39;m hoping to use to calculate reverberation lags around accreting black holes and X-ray binaries, which split up a monolithic project into more manageable packages. In specific, <a href="https://github.com/astro-group-bristol/AccretionGeometry.jl">AccretionGeometry.jl</a> now handles all of the intersection calculations between geodesics and discs, but, also, <em>much more</em>. An intention has always been to later incorporate MHD simulations of accretion discs into the ray-tracer, to more accurately model light curves coming from accreting objects, which are commonly exported as some kind of mesh or grid. In the prior case, intersections between the mesh and traced geodesics need to be determined.</p> <p> <h2>Overview</h2> <div class=franklin-toc ><ol><li><a href="#meshes_and_intersections">Meshes and intersections</a><ol><li><a href="#jiménez_segura_and_feito_2010">Jiménez, Segura and Feito &#40;2010&#41;</a><li><a href="#implementing_mesh_intersections">Implementing mesh intersections</a></ol><li><a href="#benchmarking">Benchmarking</a><li><a href="#meshes_in_curved_geometries">Meshes in curved geometries</a><ol><li><a href="#russels_teapot">Russel&#39;s teapot</a><li><a href="#falling_teapot">Falling teapot</a></ol><li><a href="#more_meshes">More meshes</a></ol></div></p> <h2 id=meshes_and_intersections ><a href="#meshes_and_intersections" class=header-anchor >Meshes and intersections</a></h2> <p>JuliaGeometry have <a href="https://github.com/JuliaGeometry/Meshes.jl">Meshes.jl</a> for computational geometry and meshing algorithms, which exports a <code>has_intersect</code> function, returning <code>true</code> or <code>false</code> if one geometric object intersects with another. In practice, I was unable to get this to work with the <code>Segment</code> and <code>Mesh</code> type, so, instead, opted to try and implement my own algorithm. </p> <p>Mesh files &#40;such as <code>.obj</code> files&#41; define a series of vertices and the faces that connect them, effectively reducing some geometry into a collection of triangles. JuliaIO has the package <a href="https://github.com/JuliaIO/MeshIO.jl">MeshIO.jl</a> for importing and exporting various mesh file formats into a standardized <code>GeometryBasics.Mesh</code> struct. Conventiently, this has a recipe for <a href="https://makie.juliaplots.org/stable/">Makie.jl</a>:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> FileIO
<span class=hljs-keyword >using</span> CairoMakie, Makie

teapot = load(<span class=hljs-string >&quot;teapot.obj&quot;</span>)

mesh(teapot, color=:blue)</code></pre> <p><img src="/blog/assets/teapot.png" alt=teapot-simple  /></p> <p>Internally, these meshes are of type <code>Mesh&#123;3, Float32, Triangle&#125;</code>, effectively an array of <code>Triangle</code> primitives that can be iterated over. For some line segment defined by the points <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><msub><mi>Q</mi><mn>1</mn></msub><mo separator=true >,</mo><msub><mi>Q</mi><mn>2</mn></msub><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(Q_1, Q_2)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span></span>, we can determine whether an intersection with the mesh occurs by checking if the segment intersects with any of the triangles. We can start sketching this out in code:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> does_intersect(mesh::Mesh{<span class=hljs-number >3</span>, T}, segment) <span class=hljs-keyword >where</span> {T}
    <span class=hljs-keyword >for</span> tri <span class=hljs-keyword >in</span> mesh
        <span class=hljs-keyword >if</span> intersects(tri, segment)
            <span class=hljs-keyword >return</span> <span class=hljs-literal >true</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-literal >false</span>
<span class=hljs-keyword >end</span></code></pre> <p>The intersection between a segment and a triangle is a well studied problem: a brief search on the internet and you might stumble over <a href="https://www.sciencedirect.com/science/article/pii/S0925772109001448">&quot;A robust segment/triangle intersection algorithm for interference tests&quot;</a> by Jiménez, Segura and Feito &#40;2010&#41;, which details a few classic algorithms and introduces a novel approach, which I will attempt to detail.</p> <h3 id="jiménez_segura_and_feito_2010"><a href="#jiménez_segura_and_feito_2010" class=header-anchor >Jiménez, Segura and Feito &#40;2010&#41;</a></h3> <p>The authors derive their algorithm in <a href="https://en.wikipedia.org/wiki/Barycentric_coordinate_system"><em>barycentric</em> coordinates</a> – effectively center of mass coordinates for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi mathvariant=double-struck >R</mi><mi>N</mi></msup></mrow><annotation encoding="application/x-tex">\mathbb{R}^N</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8413309999999999em;vertical-align:0em;"></span><span class=mord ><span class="mord mathbb">R</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8413309999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span></span></span></span></span></span></span> with respect to some <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">N+1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >1</span></span></span></span> points. For regular three dimensions, these coordinates are given relative to the vertices of a tetrahedron formed by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ABCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>. The coordinates are parameterized by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo separator=true >,</mo><mi>β</mi><mo separator=true >,</mo><mi>γ</mi><mo separator=true >,</mo><mi>δ</mi><mo>∈</mo><mi mathvariant=double-struck >R</mi><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex">\alpha, \beta, \gamma, \delta \in \mathbb{R},</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∈</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.88333em;vertical-align:-0.19444em;"></span><span class="mord mathbb">R</span><span class=mpunct >,</span></span></span></span> thus a point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> is given by</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>+</mo><mi>β</mi><mo>+</mo><mi>γ</mi><mo>+</mo><mi>δ</mi><mo stretchy=false >)</mo><mi>P</mi><mo>=</mo><mi>α</mi><mi>A</mi><mo>+</mo><mi>β</mi><mi>B</mi><mo>+</mo><mi>γ</mi><mi>C</mi><mo>+</mo><mi>δ</mi><mi>D</mi><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> (\alpha + \beta + \gamma + \delta) P = \alpha A + \beta B + \gamma C + \delta D, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mclose >)</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05017em;">βB</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">δD</span><span class=mpunct >,</span></span></span></span></span> <p>with the special property that multiplication by some non-zero <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi></mrow><annotation encoding="application/x-tex">\lambda</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal">λ</span></span></span></span> leaves <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> unchanged. Consequently, barycentric coordinates are degenerate, and two sets may be equivalent <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>:</mo><mi>β</mi><mo>:</mo><mi>γ</mi><mo>:</mo><mi>δ</mi><mo stretchy=false >)</mo><mo>=</mo><mi>λ</mi><mo stretchy=false >(</mo><mi>α</mi><mo mathvariant=normal >′</mo><mo>:</mo><mi>β</mi><mo mathvariant=normal >′</mo><mo>:</mo><mi>γ</mi><mo mathvariant=normal >′</mo><mo>:</mo><mi>δ</mi><mo mathvariant=normal >′</mo><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(\alpha : \beta : \gamma : \delta) = \lambda (\alpha\prime : \beta\prime : \gamma\prime : \delta\prime)</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">λ</span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mord >′</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mord >′</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.75em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mord >′</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mord >′</span><span class=mclose >)</span></span></span></span>. Uniqueness of the coordinates is imposed through the requirement</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mi>α</mi><mo>+</mo><mi>β</mi><mo>+</mo><mi>γ</mi><mo>+</mo><mi>δ</mi><mo>=</mo><mn>1</mn><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \alpha + \beta + \gamma + \delta = 1, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span></span><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8388800000000001em;vertical-align:-0.19444em;"></span><span class=mord >1</span><span class=mpunct >,</span></span></span></span></span> <p>lifting the degeneracy.</p> <p>The signed, or orientated, volume of the tetrahedron formed by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ABCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mrow><mo stretchy=false >∣</mo><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo><mo>=</mo><mfrac><mn>1</mn><mn>6</mn></mfrac><mrow><mo fence=true >∣</mo><mtable rowspacing=0.1600em  columnalign=center  columnspacing=1em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>A</mi><mo>−</mo><mi>D</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>B</mi><mo>−</mo><mi>D</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=false ><mrow><mi>C</mi><mo>−</mo><mi>D</mi></mrow></mstyle></mtd></mtr></mtable><mo fence=true >∣</mo></mrow><mo separator=true >,</mo></mrow><annotation encoding="application/x-tex"> \lvert ABCD \rvert = \frac{1}{6} \begin{vmatrix} A - D \\ B - D \\ C - D \end{vmatrix}, </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >∣</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:3.6120399999999995em;vertical-align:-1.5500299999999998em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >6</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class=mopen ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.06201em;"><span style="top:-2.86601em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.46401em;"><span class=pstrut  style="height:4.41604em;"></span><span style="height:2.4160399999999997em;width:0.333em;"><svg width='0.333em' height='2.4160399999999997em' style='width:0.333em' viewBox='0 0 333 2416' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V2416 H145z M145 0 H188 V2416 H145z'/></svg></span></span><span style="top:-5.87205em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.5500299999999998em;"><span></span></span></span></span></span></span><span class=mord ><span class=mtable ><span class=col-align-c ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.05em;"><span style="top:-4.21em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal">A</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span><span style="top:-3.0099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span><span style="top:-1.8099999999999994em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.5500000000000007em;"><span></span></span></span></span></span></span></span><span class=mclose ><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:2.06201em;"><span style="top:-2.86601em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.46401em;"><span class=pstrut  style="height:4.41604em;"></span><span style="height:2.4160399999999997em;width:0.333em;"><svg width='0.333em' height='2.4160399999999997em' style='width:0.333em' viewBox='0 0 333 2416' preserveAspectRatio='xMinYMin'><path d='M145 0 H188 V2416 H145z M145 0 H188 V2416 H145z'/></svg></span></span><span style="top:-5.87205em;"><span class=pstrut  style="height:4.41604em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.5500299999999998em;"><span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mpunct >,</span></span></span></span></span> <p>where the rows of the matrix are elements of the subtraction. This formulation solves the barycentric coordinates uniquely via</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left right left right left right left" columnspacing="0em 1em 0em 1em 0em 1em 0em"><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi>α</mi><mo>=</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mrow><mo stretchy=false >∣</mo><mi>P</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow><mrow><mo stretchy=false >∣</mo><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow></mfrac><mo separator=true >,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi>β</mi><mo>=</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mrow><mo stretchy=false >∣</mo><mi>P</mi><mi>A</mi><mi>D</mi><mi>C</mi><mo stretchy=false >∣</mo></mrow><mrow><mo stretchy=false >∣</mo><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow></mfrac></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi>γ</mi><mo>=</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mrow><mo stretchy=false >∣</mo><mi>P</mi><mi>A</mi><mi>B</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow><mrow><mo stretchy=false >∣</mo><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow></mfrac><mo separator=true >,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mi>δ</mi><mo>=</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mrow><mo stretchy=false >∣</mo><mi>P</mi><mi>A</mi><mi>C</mi><mi>B</mi><mo stretchy=false >∣</mo></mrow><mrow><mo stretchy=false >∣</mo><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi><mo stretchy=false >∣</mo></mrow></mfrac><mi mathvariant=normal >.</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \alpha =\,&amp; \frac{\lvert PBCD \rvert}{\lvert ABCD \rvert}, &amp; \beta =\,&amp; \frac{\lvert PADC \rvert}{\lvert ABCD \rvert} &amp; \gamma =\,&amp; \frac{\lvert PABD \rvert}{\lvert ABCD \rvert}, &amp; \delta =\,&amp; \frac{\lvert PACB \rvert}{\lvert ABCD \rvert}. \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.6630000000000003em;vertical-align:-1.0815000000000001em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal" style="margin-right:0.07153em;">PBC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class=mclose >∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.5815000000000001em;"><span style="top:-3.5815em;"><span class=pstrut  style="height:3.427em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.427em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class=mclose >∣</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mopen >∣</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">CB</span><span class=mclose >∣</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord >.</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:1.0815000000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>The primary benefit of this is that establishing the location of the point <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> relative to the tetrahedron formed by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ABCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> is very easy: consider <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi></mrow><annotation encoding="application/x-tex">\alpha</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span></span></span>, for which the supporting plane is <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">BCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>:</p> <ul> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha = 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> implies <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> is <em>in the plane</em> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">BCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>,</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &gt; 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&gt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> implies <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> is on the <em>same side</em> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">BCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> as <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>,</p> <li><p><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>&lt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\alpha &lt; 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> implies <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> is on the <em>opposite side</em> of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>C</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">BCD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">BC</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span> from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>.</p> </ul> <p>The same property is true for <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>β</mi></mrow><annotation encoding="application/x-tex">\beta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>D</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">ADC</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>, <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>B</mi><mi>D</mi></mrow><annotation encoding="application/x-tex">ABD</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span></span></span></span>, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>δ</mi></mrow><annotation encoding="application/x-tex">\delta</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span></span></span></span> and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi>C</mi><mi>B</mi></mrow><annotation encoding="application/x-tex">ACB</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.05017em;">CB</span></span></span></span>. With this, we may claim:</p> <div class=theorem ><p><strong>Theorem 1:</strong></p> <p>Let <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mn>1</mn></msub><msub><mi>V</mi><mn>2</mn></msub><msub><mi>V</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">V_1 V_2 V_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be a triangle, and <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_1 Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> a segment such that <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Q_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is <em>not coplanar</em> the the plane of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mn>1</mn><mo separator=true >,</mo><mi>V</mi><mn>2</mn><mo separator=true >,</mo><mi>V</mi><mn>3</mn></mrow><annotation encoding="application/x-tex">V1, V2, V3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mord >2</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=mord >3</span></span></span></span>. The segment <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_1 Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> intersects <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mn>1</mn></msub><msub><mi>V</mi><mn>2</mn></msub><msub><mi>V</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">V_1 V_2 V_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><em>if and only if</em></p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.2500em  columnalign="right left right left right left right left" columnspacing="0em 1em 0em 1em 0em 1em 0em"><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>sign</mtext><mtext> </mtext><mi>α</mi><mo>≤</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn><mo separator=true >,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>sign</mtext><mtext> </mtext><mi>β</mi><mo>≥</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn><mo separator=true >,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>sign</mtext><mtext> </mtext><mi>γ</mi><mo>≥</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn><mo separator=true >,</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>sign</mtext><mtext> </mtext><mi>δ</mi><mo>≥</mo><mtext> </mtext></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn><mo separator=true >,</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \text{sign}\, \alpha \leq\, &amp; 0, &amp; \text{sign}\, \beta \geq\,&amp; 0, &amp; \text{sign}\, \gamma \geq\,&amp; 0, &amp; \text{sign}\, \delta \geq\,&amp; 0, \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1.5000000000000002em;vertical-align:-0.5000000000000002em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >sign</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≤</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >sign</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≥</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >sign</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≥</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >sign</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≥</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1em;"><span style="top:-3.16em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span><span class=mpunct >,</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.5000000000000002em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >(</mo><mi>α</mi><mo>:</mo><mi>β</mi><mo>:</mo><mi>γ</mi><mo>:</mo><mi>δ</mi><mo stretchy=false >)</mo></mrow><annotation encoding="application/x-tex">(\alpha : \beta : \gamma : \delta )</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >(</span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05556em;">γ</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >:</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.03785em;">δ</span><span class=mclose >)</span></span></span></span> are the barycentric coordinates of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> with respect to the tetrahedron <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub><msub><mi>V</mi><mn>1</mn></msub><msub><mi>V</mi><mn>2</mn></msub><msub><mi>V</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">Q_1 V_1 V_2 V_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>.</p></div> <p>The sketch of this proof follows by considering the region restrictions imposed by the inequalities; <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>sign</mtext><mtext> </mtext><mi>α</mi><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\text{sign}\, \alpha \leq 0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8623000000000001em;vertical-align:-0.19444em;"></span><span class="mord text"><span class=mord >sign</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >≤</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> states <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> must be on the opposite side of the triangle formed by <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mn>1</mn></msub><msub><mi>V</mi><mn>2</mn></msub><msub><mi>V</mi><mn>3</mn></msub></mrow><annotation encoding="application/x-tex">V_1 V_2 V_3</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.83333em;vertical-align:-0.15em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.22222em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> from <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Q_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, and the other inequalities restrict <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> within the tetrahedron if the sides were projected to infinity.</p> <p>The authors provide a full proof, and also an algorithm which I have taken the liberty of implementing in Julia:</p> <pre><code class="julia hljs"><span class=hljs-comment ># Jiménez, Segura, Feito. Computation Geometry 43 (2010) 474-492</span>
<span class=hljs-keyword >function</span> jsr_algorithm(V₁::T, V₂::T, V₃::T, Q₁::V, Q₂::V; ϵ = <span class=hljs-number >1e-6</span>) <span class=hljs-keyword >where</span> {T,V}
    A = Q₁ .- V₃
    B = V₁ .- V₃
    C = V₂ .- V₃
    W₁ = B × C
    w = A ⋅ W₁
    <span class=hljs-keyword >if</span> w &gt; ϵ
        D = Q₂ .- V₃
        s = D ⋅ W₁
        s &gt; ϵ &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        W₂ = A × D
        t = W₂ ⋅ C
        t &lt; -ϵ &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        u = -W₂ ⋅ B
        u &lt; -ϵ &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        w &lt; s + t + u &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
    <span class=hljs-keyword >elseif</span> w &lt; -ϵ
        <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
    <span class=hljs-keyword >else</span> <span class=hljs-comment ># w == 0</span>
        D = Q₂ .- V₃
        s = D ⋅ W₁
        <span class=hljs-keyword >if</span> s &gt; ϵ
            <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        <span class=hljs-keyword >elseif</span> s &lt; -ϵ
            W₂ = D × A
            t = W₂ ⋅ C
            t &gt; ϵ &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
            u = -W₂ ⋅ B
            u &gt; ϵ &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
            -s &gt; t + u &amp;&amp; <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        <span class=hljs-keyword >else</span>
            <span class=hljs-keyword >return</span> <span class=hljs-literal >false</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-literal >true</span>
<span class=hljs-keyword >end</span></code></pre> <p>This algorithm has <a href="https://en.wikipedia.org/wiki/Back-face_culling">back-face culling</a>. </p> <p>As a side note, algorithms in Julia are <em>absolutely beautiful</em>. </p> <p>Note that the types of the triangle vertices and point vertices have been left generic under the restriction that they must be similar – this technically isn&#39;t required, but I&#39;ve left in because it has helped me catch some strange type conversion elsewhere in my code.</p> <h3 id=implementing_mesh_intersections ><a href="#implementing_mesh_intersections" class=header-anchor >Implementing mesh intersections</a></h3> <p>With the above algorithm, we can now write some trivial wrapper code, and begin calculating segment with mesh intersections. For simplicity, I&#39;m going to treat any array of tuple of vectors as a segment, instead of using a geometry primitive:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> has_intersect(mesh, seg)
    <span class=hljs-keyword >for</span> tri <span class=hljs-keyword >in</span> mesh
        <span class=hljs-keyword >if</span> jsr_algorithm(tri[<span class=hljs-number >1</span>], tri[<span class=hljs-number >2</span>], tri[<span class=hljs-number >3</span>], seg[<span class=hljs-number >1</span>], seg[<span class=hljs-number >2</span>])
            <span class=hljs-comment ># break early</span>
            <span class=hljs-keyword >return</span> <span class=hljs-literal >true</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-literal >false</span>
<span class=hljs-keyword >end</span></code></pre> <p>Then we&#39;ll write a utility method for generating random segments in a given range, and create a plotting function which colors the lines according to whether they intersect with the teapot:</p> <pre><code class="julia hljs"><span class=hljs-keyword >function</span> plot_segments(teapot, segments)
    mp = mesh(teapot, color=:blue)
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> segments
        lines!(
            mp.axis,
            [s[<span class=hljs-number >1</span>] ; s[<span class=hljs-number >2</span>]],
            color=has_intersect(teapot, s) ? :green : :red
        )
    <span class=hljs-keyword >end</span>
    mp
<span class=hljs-keyword >end</span>

<span class=hljs-comment ># seed RNG for reproducible figures</span>
<span class=hljs-keyword >import</span> Random: seed!
seed!(<span class=hljs-number >2022</span>)

randsegment(range) = <span class=hljs-built_in >Tuple</span>(<span class=hljs-built_in >Tuple</span>(rand(-range:<span class=hljs-number >0.1</span>:range) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >3</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >2</span>)
plot_segments(teapot, [rand_segment(<span class=hljs-number >3.0</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >10</span>])</code></pre> <p>Unfortunately Makie by default will draw lines behind meshes, so the figure isn&#39;t as illustrative as initially hoped, but it is somewhat convincing that the intersection algorithm is working.</p> <p><img src="/blog/assets/line-teapot-intersect.png" alt=teapot-simple  /></p> <p>Here the green lines intersect with the teapot, whereas the red lines do not. </p> <h2 id=benchmarking ><a href="#benchmarking" class=header-anchor >Benchmarking</a></h2> <p>We&#39;ll benchmark a given collection of segments with BenchmarkTools.jl to see how performant the intersection algorithm is:</p> <pre><code class="julia hljs">seed!(<span class=hljs-number >2022</span>)
segments = [randsegment(<span class=hljs-number >3.0</span>) <span class=hljs-keyword >for</span> _ <span class=hljs-keyword >in</span> <span class=hljs-number >1</span>:<span class=hljs-number >10_000</span>]

<span class=hljs-keyword >function</span> test(teapot, segments)
    <span class=hljs-keyword >for</span> s <span class=hljs-keyword >in</span> segments
        has_intersect(teapot, s)
    <span class=hljs-keyword >end</span>
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >using</span> BenchmarkTools
<span class=hljs-meta >@btime</span> test($teapot, $segments)
<span class=hljs-comment ># 757.721 ms (0 allocations: 0 bytes)</span></code></pre> <p>This is already pretty good. The exact same performance is obtained if the segments are <code>Tuple&#123;SVector&#123;3, Float64&#125;,SVector&#123;3, Float64&#125;&#125;</code>, using the <code>SVector</code> type from <a href="https://github.com/JuliaArrays/StaticArrays.jl">StaticArrays.jl</a>. We can also convert the mesh structure to use <code>SVector</code> for the triangles:</p> <pre><code class="julia hljs">static_teapot = map(teapot) <span class=hljs-keyword >do</span> triangle
    <span class=hljs-built_in >Tuple</span>(SVector(p[<span class=hljs-number >1</span>], p[<span class=hljs-number >2</span>], p[<span class=hljs-number >3</span>]) <span class=hljs-keyword >for</span> p <span class=hljs-keyword >in</span> triangle)
<span class=hljs-keyword >end</span>

<span class=hljs-meta >@btime</span> bench($static_teapot, $segments)
<span class=hljs-comment ># 578.608 ms (0 allocations: 0 bytes)</span></code></pre> <p>This yields a slight performance boost, which will make a significant difference when plugging this into the geodesic ray tracer.</p> <h2 id=meshes_in_curved_geometries ><a href="#meshes_in_curved_geometries" class=header-anchor >Meshes in curved geometries</a></h2> <p>The software I have been working on for tracing geodesics around arbitrary spacetimes has recently undergone a large refactor, which makes strapping something like mesh-intersections quite straight forward. In fact, I implemented meshes as a feature in <a href="https://github.com/astro-group-bristol/AccretionGeometry.jl">AccretionGeometry.jl</a> before even writing this post.</p> <p>These was done by pre-calculating a bounding box around the meshes, and converting the mesh structure into StaticArrays, just as above:</p> <pre><code class="julia hljs"><span class=hljs-comment ># snippet from AccretionGeometry/src/meshes.jl</span>
<span class=hljs-keyword >struct</span> MeshAccretionGeometry{T} &lt;: AbstractAccretionGeometry{T}
    mesh::<span class=hljs-built_in >Vector</span>{<span class=hljs-built_in >Tuple</span>{SVector{<span class=hljs-number >3</span>,T},SVector{<span class=hljs-number >3</span>,T},SVector{<span class=hljs-number >3</span>,T}}}
    x_extent::<span class=hljs-built_in >Tuple</span>{T,T}
    y_extent::<span class=hljs-built_in >Tuple</span>{T,T}
    z_extent::<span class=hljs-built_in >Tuple</span>{T,T}
<span class=hljs-keyword >end</span>

<span class=hljs-keyword >function</span> MeshAccretionGeometry(mesh)
    static_mesh = map(mesh) <span class=hljs-keyword >do</span> triangle
        <span class=hljs-built_in >Tuple</span>(SVector(p[<span class=hljs-number >1</span>], p[<span class=hljs-number >2</span>], p[<span class=hljs-number >3</span>]) <span class=hljs-keyword >for</span> p <span class=hljs-keyword >in</span> triangle)
    <span class=hljs-keyword >end</span>
    MeshAccretionGeometry(static_mesh, bounding_box(mesh)...)
<span class=hljs-keyword >end</span>
<span class=hljs-comment ># ...</span></code></pre> <p>The bounding box is used to determine whether the segment &#40;here called <code>line_element</code>&#41; currently traced is close to the mesh geometry or not – this way we can discriminate having to run the intersection algorithm for geodesics which are far from the mesh:</p> <pre><code class="julia hljs"><span class=hljs-comment ># snippet from AccretionGeometry/src/meshes.jl</span>
<span class=hljs-keyword >function</span> in_nearby_region(m::MeshAccretionGeometry{T}, line_element) <span class=hljs-keyword >where</span> {T}
    p = line_element[<span class=hljs-number >2</span>]
    <span class=hljs-meta >@inbounds</span> m.x_extent[<span class=hljs-number >1</span>] &lt; p[<span class=hljs-number >1</span>] &lt; m.x_extent[<span class=hljs-number >2</span>] &amp;&amp;
              m.y_extent[<span class=hljs-number >1</span>] &lt; p[<span class=hljs-number >2</span>] &lt; m.y_extent[<span class=hljs-number >2</span>] &amp;&amp;
              m.z_extent[<span class=hljs-number >1</span>] &lt; p[<span class=hljs-number >3</span>] &lt; m.z_extent[<span class=hljs-number >2</span>]
<span class=hljs-keyword >end</span>
<span class=hljs-comment ># ...</span></code></pre> <p>invoked in </p> <pre><code class="julia hljs"><span class=hljs-comment ># snippet from AccretionGeometry/src/intersections.jl</span>
<span class=hljs-keyword >function</span> intersects_geometry(m::AbstractAccretionGeometry{T}, line_element) <span class=hljs-keyword >where</span> {T}
    <span class=hljs-keyword >if</span> in_nearby_region(m, line_element)
        <span class=hljs-keyword >return</span> has_intersect(m, line_element)
    <span class=hljs-keyword >end</span>
    <span class=hljs-literal >false</span>
<span class=hljs-keyword >end</span></code></pre> <p>The <code>has_intersect</code> function is then implemented just as above, with one other small optimization pass:</p> <ul> <li><p>since the integrator is calculating small steps at a time, we can assume <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy=false >∥</mo><msub><mi>Q</mi><mn>1</mn></msub><msub><mi>Q</mi><mn>2</mn></msub><mo stretchy=false >∥</mo><mo>&lt;</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex">\lVert Q_1Q_2 \rVert &lt; \varepsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class=mopen >∥</span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >∥</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >&lt;</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ε</span></span></span></span>, where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ε</span></span></span></span> is some <em>sufficiently</em> small distance,</p> <li><p>since the geodesics are being integrated from a known source, we know <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> will always be ahead of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">Q_1</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, and,</p> <li><p>the mesh triangles are generally small, comparable to <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal">ε</span></span></span></span> &#40;arguable&#41;.</p> </ul> <p>The second assumption means we could theoretically eliminate the <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">w=0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >0</span></span></span></span> branch of the JSR algorithm, as the orientation of the segment never needs swapping, but when benchmarked, that resulted in negligible performance gain but may introduce bugs later down the line. Instead, we can combine all three assumptions and implement a new condition:</p> <pre><code class="julia hljs"><span class=hljs-comment ># snippet from AccretionGeometry/src/meshes.jl</span>
<span class=hljs-keyword >function</span> has_intersect(m::MeshAccretionGeometry{T}, line_element) <span class=hljs-keyword >where</span> {T}
    <span class=hljs-keyword >for</span> triangle <span class=hljs-keyword >in</span> m.mesh
        dist_sq = sum((triangle[<span class=hljs-number >1</span>] .- line_element[<span class=hljs-number >2</span>]) .^ <span class=hljs-number >2</span>)
        <span class=hljs-keyword >if</span> dist_sq &lt; <span class=hljs-number >3.0</span> &amp;&amp; jsr_algorithm(triangle..., line_element...)
            <span class=hljs-keyword >return</span> <span class=hljs-literal >true</span>
        <span class=hljs-keyword >end</span>
    <span class=hljs-keyword >end</span>
    <span class=hljs-literal >false</span>
<span class=hljs-keyword >end</span>
<span class=hljs-comment ># ...</span></code></pre> <p>This basically checks if the first vertex of the triangle is within a certain distance of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, and skips running JSR if it is not. This way, we consider only mesh triangles in the local neighbourhood of <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Q</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">Q_2</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class=mord ><span class="mord mathnormal">Q</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>. This condition is quite tentative, and the magic value <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3.0</mn></mrow><annotation encoding="application/x-tex">3.0</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.64444em;vertical-align:0em;"></span><span class=mord >3.0</span></span></span></span> is <em>very magic</em>, and would need scaling with the third assumptions. In practice, however, this benchmarks at <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>×</mo></mrow><annotation encoding="application/x-tex">2\times</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.72777em;vertical-align:-0.08333em;"></span><span class=mord >2</span><span class=mord >×</span></span></span></span> speed, with an error lower than the integrator tolerance.</p> <h3 id=russels_teapot ><a href="#russels_teapot" class=header-anchor >Russel&#39;s teapot</a></h3> <p>If you haven&#39;t heard of <a href="https://en.wikipedia.org/wiki/Russell&#37;27s_teapot">Russel&#39;s teapot</a>, it is the philosophical notion that if something cannot be disproven, then that does not mean it is true. Bertrand Russel illustrates this by imagining a teapot floating somewhere in space, and says you cannot be expected to believe that this teapot <em>really exists</em> solely because <em>you cannot disprove</em> it.</p> <p>The antithesis of this is stating just because something cannot be disproved, doesn&#39;t mean it&#39;s not true.</p> <p>Either way, <em>we can now</em> visualize what would happen if Russel&#39;s teapot were close to a maximally spinning Kerr black hole. The teapot model needs to be moved next to the black hole, which can be accomplished with <a href="https://github.com/JuliaGeometry/CoordinateTransformations.jl">CoordinateTransformations.jl</a> and <a href="https://github.com/JuliaGeometry/Rotations.jl">Rotations.jl</a>:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> CoordinateTransformations, Rotations
<span class=hljs-keyword >using</span> AccretionGeometry

xfm = Translations(-<span class=hljs-number >4.0</span>, <span class=hljs-number >4.5</span>, -<span class=hljs-number >2.0</span>) ∘ LinearMap(RotXY(<span class=hljs-literal >π</span>/<span class=hljs-number >2</span>, <span class=hljs-literal >π</span>/<span class=hljs-number >2</span>))

<span class=hljs-comment ># utility function to map transformation onto the mesh</span>
apply_xfm(xfm, mesh) = map(tri -&gt; xfm.(tri), mesh)

xfmed_teapot = apply_xfm(xfm, static_teapot)
bbox = AccretionGeometry.bounding_box(xfmed_teapot)

russels_teapot = MeshAccretionGeometry(xfmed_teapot, bbox...)</code></pre> <p>More constructors for <code>MeshAccretionGeometry</code> will be implemented, and also tied together with the transformation libraries to make this process easier. In the above, the transformation and rotation values are arbitrary, and just move the teapot outside of the event horizon somewhere.</p> <p>Rendering the teapot is then very straight forward:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> ComputedGeodesicEquations <span class=hljs-comment ># for the Kerr metric</span>

m = BoyerLindquist(M=<span class=hljs-number >1.0</span>, a=<span class=hljs-number >0.998</span>)
u = <span class=hljs-meta >@SVector</span> [<span class=hljs-number >0.0</span>, <span class=hljs-number >1000.0</span>, deg2rad(<span class=hljs-number >85.0</span>), <span class=hljs-number >0.0</span>] <span class=hljs-comment ># initial position</span>

img = rendergeodesics(
    m, u, <span class=hljs-number >2000.0</span>, russels_teapot;
    fox_factor = <span class=hljs-number >15.0</span>,  <span class=hljs-comment ># zoom in a little</span>
    image_width = <span class=hljs-number >350</span>,
    image_height = <span class=hljs-number >250</span>,
    abstol = <span class=hljs-number >1e-8</span>,      <span class=hljs-comment ># lower tolerances since we&#x27;re doing this for</span>
    reltol = <span class=hljs-number >1e-8</span>       <span class=hljs-comment ># aesthetics and want quicker renders</span>
)

heatmap(img)</code></pre> <p><img src="/blog/assets/russels-teapot.png" alt="" /></p> <p>This takes about 8 seconds to render using CPU threads &#40;default&#41;.</p> <p>I used Plots.jl for the heatmap instead of Makie, since it was a little more convenient at the time.</p> <p>The current default <code>ValueFunction</code> colours pixels by the affine parameter value &#40;proper time&#41; where the geodesic terminated, which can give a mild impression of three dimensionality by restricting the colour map.</p> <h3 id=falling_teapot ><a href="#falling_teapot" class=header-anchor >Falling teapot</a></h3> <p>Here is a little script that animates a teapot falling towards a Kerr black hole. To do this, the teapot is moved rendered again:</p> <pre><code class="julia hljs">n = <span class=hljs-number >30</span>          <span class=hljs-comment ># number of frames</span>
images = []
<span class=hljs-keyword >for</span> (i, x) <span class=hljs-keyword >in</span> enumerate(<span class=hljs-number >0</span>:<span class=hljs-number >0</span>:<span class=hljs-number >9.5</span>/n:<span class=hljs-number >9.5</span>)
    move_xfm = Translation(<span class=hljs-number >0.0</span>, -x, <span class=hljs-number >0.0</span>)
    moved_teapot_mesh = apply_xfm(move_xfm, xfmed_teapot)

    move_bbox = AccretionGeometry.bounding_box(moved_teapot_mesh)
    moved_teapot = MeshAccretionGeometry(moved_teapot_mesh, move_bbox...)

    img = rendergeodesics(
        m, u, <span class=hljs-number >2000.0</span>, russels_teapot;
        fox_factor = <span class=hljs-number >15.0</span>,
        image_width = <span class=hljs-number >350</span>,
        image_height = <span class=hljs-number >250</span>,
        abstol = <span class=hljs-number >1e-8</span>,
        reltol = <span class=hljs-number >1e-8</span>
    )

    push!(images, img)
    println(<span class=hljs-string >&quot;Completed <span class=hljs-variable >$i</span> of <span class=hljs-subst >$(n+<span class=hljs-number >1</span>)</span>...&quot;</span>)
<span class=hljs-keyword >end</span></code></pre> <p>I wrote a small conversion to transform the <code>images</code> vector into <code>UInt8</code> images; the values are arbitrary, but give a decent contrast:</p> <pre><code class="julia hljs">truncator(px) = clamp(px, <span class=hljs-built_in >UInt8</span>)

anim = map(images) <span class=hljs-keyword >do</span> img
    img_copy = copy(img) <span class=hljs-comment ># for experimenting without re-rendering</span>
    img_copy[img .=== <span class=hljs-literal >NaN</span>] .= <span class=hljs-number >992</span> <span class=hljs-comment ># minimum pixel value (magic)</span>
    img_copy = @. <span class=hljs-number >255</span> * (img_copy - <span class=hljs-number >992</span>) / (<span class=hljs-number >1005</span>-<span class=hljs-number >992</span>) <span class=hljs-comment ># magic max-min</span>
    truncator.(img_copy)
<span class=hljs-keyword >end</span></code></pre> <p>And finally, to export as a gif, we just have to reshape the array:</p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Images

anim_frames = reduce((i,j) -&gt; cat(i, j, dims=<span class=hljs-number >3</span>), anim)
save(<span class=hljs-string >&quot;teapot.gif&quot;</span>, anim_frames, fps=<span class=hljs-number >12</span>)</code></pre> <p><img src="/blog/assets/blog-teapot-small.gif" alt="" /></p> <h2 id=more_meshes ><a href="#more_meshes" class=header-anchor >More meshes</a></h2> <p>Any meshes file compatible with MeshIO.jl <em>should</em> now work with this tracer, as long as it can be decomposed into a series of triangles. To illustrate this, here is a small cow:</p> <div style="text-align: center;"> <img src="/blog/assets/cropped-cow.png" alt="" style="max-width: 300px; padding: 0px;"/> </div> <p>And increasing the image resolutions a litte, this cow also goes around &#40;over&#41; the black hole &#40;moon&#41;:</p> <p><img src="/blog/assets/cow-render.gif" alt="" /></p> <p>Particularly neat are the inverted false-images on the left side of the black hole.</p> <div class=page-foot > <div class=copyright > &copy; Fergus Baker. Last modified: April 18, 2022. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>